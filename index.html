<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memorin - 本地知识复习系统</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- Chart.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.min.js"></script>
</head>
<body>
    <!-- 头部导航 -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>Memorin</h1>
                    <span class="subtitle">知识复习系统</span>
                </div>
                <nav class="main-nav">
                    <ul class="nav-list">
                        <li><a href="#" data-section="dashboard" class="nav-link active">仪表板</a></li>
                        <li><a href="#" data-section="knowledge" class="nav-link">知识管理</a></li>
                        <li><a href="#" data-section="review" class="nav-link">开始复习</a></li>
                        <li><a href="#" data-section="mistakes" class="nav-link">错题本</a></li>
                        <li><a href="#" data-section="statistics" class="nav-link">统计分析</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- 主要内容区 -->
    <main class="main">
        <div class="container">
            <!-- 仪表板页面 -->
            <section id="dashboard" class="content-section active">
                <div class="dashboard-header">
                    <h2>学习概览</h2>
                    <p class="welcome-text">欢迎回到Memorin，继续您的学习之旅！</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">📚</div>
                        <div class="stat-content">
                            <h3 id="total-knowledge">0</h3>
                            <p>总知识点</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">🎯</div>
                        <div class="stat-content">
                            <h3 id="today-review">0</h3>
                            <p>今日待复习</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">✅</div>
                        <div class="stat-content">
                            <h3 id="mastered-count">0</h3>
                            <p>已掌握</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">❌</div>
                        <div class="stat-content">
                            <h3 id="mistakes-count">0</h3>
                            <p>错题数量</p>
                        </div>
                    </div>
                </div>

                <div class="quick-actions">
                    <h3>快速操作</h3>
                    <div class="action-buttons">
                        <button class="btn btn-primary" data-action="start-review">开始复习</button>
                        <button class="btn btn-secondary" data-action="review-mistakes">复习错题</button>
                        <button class="btn btn-success" onclick="importAllMilitaryKnowledge()">导入军理知识库</button>
                        <button class="btn btn-info" onclick="importAllSoftwareEngineeringKnowledge()">💻 导入软件工程知识库</button>
                        <button class="btn btn-secondary" onclick="quickFixAllData()">🔧 快速修复数据</button>
                        <button class="btn btn-warning" onclick="clearAllDataWithConfirm()">🗑️ 清空所有数据</button>
                    </div>
                    <div class="data-info">
                        <h4>数据管理</h4>
                        <div id="knowledge-bases-info" class="info-section">
                            <!-- 知识库信息将在这里显示 -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- 知识管理页面 -->
            <section id="knowledge" class="content-section">
                <!-- 知识库选择视图 -->
                <div id="knowledge-base-view" class="knowledge-view active">
                    <div class="section-header">
                        <h2>📚 知识库管理</h2>
                        <div class="header-actions">
                            <button class="btn btn-primary" id="add-knowledge-base-btn">创建知识库</button>
                            <button class="btn btn-secondary" id="import-btn">导入数据</button>
                            <button class="btn btn-secondary" id="export-btn">导出数据</button>
                        </div>
                    </div>
                    
                    <div class="knowledge-base-grid" id="knowledge-base-grid">
                        <!-- 知识库卡片将通过JavaScript动态生成 -->
                    </div>
                </div>

                <!-- 知识区选择视图 -->
                <div id="knowledge-area-view" class="knowledge-view">
                    <div class="section-header">
                        <button class="btn btn-ghost back-btn" id="back-to-base">
                            <span>← 返回知识库</span>
                        </button>
                        <h2 id="current-base-title">知识库名称</h2>
                        <div class="header-actions">
                            <button class="btn btn-primary" id="add-knowledge-area-btn">添加知识区</button>
                            <button class="btn btn-secondary" id="review-all-base-btn">复习整个知识库</button>
                        </div>
                    </div>
                    
                    <div class="knowledge-area-grid" id="knowledge-area-grid">
                        <!-- 知识区卡片将通过JavaScript动态生成 -->
                    </div>
                </div>

                <!-- 知识点列表视图 -->
                <div id="knowledge-points-view" class="knowledge-view">
                    <div class="section-header">
                        <button class="btn btn-ghost back-btn" id="back-to-area">
                            <span>← 返回知识区</span>
                        </button>
                        <h2 id="current-area-title">知识区名称</h2>
                        <div class="header-actions">
                            <button class="btn btn-primary" id="add-knowledge-point-btn">添加知识点</button>
                            <button class="btn btn-success" id="review-area-btn">开始复习本知识区</button>
                            <button class="btn btn-secondary" id="expand-all-btn">全部展开</button>
                            <button class="btn btn-secondary" id="collapse-all-btn" style="display: none;">全部收起</button>
                        </div>
                    </div>
                    
                    <div class="knowledge-controls">
                        <div class="search-box">
                            <input type="text" id="search-input" placeholder="搜索知识点...">
                        </div>
                        <div class="filter-controls">
                            <select id="tag-filter" aria-label="按标签筛选">
                                <option value="">所有标签</option>
                            </select>
                        </div>
                    </div>

                    <div class="knowledge-points-list" id="knowledge-points-list">
                        <!-- 知识点列表将通过JavaScript动态生成 -->
                    </div>
                </div>
            </section>

            <!-- 创建知识库模态框 -->
            <div id="create-knowledge-base-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>📚 创建新知识库</h3>
                        <button class="close-btn" data-modal="create-knowledge-base-modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="create-knowledge-base-form">
                            <div class="form-group">
                                <label for="kb-name">知识库名称 *</label>
                                <input type="text" id="kb-name" name="name" required 
                                       placeholder="例如：计算机基础知识、英语词汇、历史知识等">
                            </div>
                            
                            <div class="form-group">
                                <label for="kb-description">知识库描述</label>
                                <textarea id="kb-description" name="description" rows="3" 
                                         placeholder="简要描述这个知识库的内容和用途..."></textarea>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="kb-icon">图标选择</label>
                                    <div class="icon-selector">
                                        <input type="hidden" id="kb-icon" name="icon" value="📚">
                                        <div class="icon-grid">
                                            <button type="button" class="icon-option active" data-icon="📚">📚</button>
                                            <button type="button" class="icon-option" data-icon="🎯">🎯</button>
                                            <button type="button" class="icon-option" data-icon="💡">💡</button>
                                            <button type="button" class="icon-option" data-icon="🔬">🔬</button>
                                            <button type="button" class="icon-option" data-icon="🌟">🌟</button>
                                            <button type="button" class="icon-option" data-icon="⚡">⚡</button>
                                            <button type="button" class="icon-option" data-icon="🎨">🎨</button>
                                            <button type="button" class="icon-option" data-icon="🏆">🏆</button>
                                            <button type="button" class="icon-option" data-icon="🔥">🔥</button>
                                            <button type="button" class="icon-option" data-icon="💎">💎</button>
                                            <button type="button" class="icon-option" data-icon="🚀">🚀</button>
                                            <button type="button" class="icon-option" data-icon="🎪">🎪</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="kb-color">主题颜色</label>
                                    <div class="color-selector">
                                        <input type="hidden" id="kb-color" name="color" value="#667eea">
                                        <div class="color-grid">
                                            <button type="button" class="color-option active" data-color="#667eea" style="background: #667eea;" title="蓝紫色"></button>
                                            <button type="button" class="color-option" data-color="#f093fb" style="background: #f093fb;" title="粉紫色"></button>
                                            <button type="button" class="color-option" data-color="#4facfe" style="background: #4facfe;" title="天蓝色"></button>
                                            <button type="button" class="color-option" data-color="#43e97b" style="background: #43e97b;" title="绿色"></button>
                                            <button type="button" class="color-option" data-color="#fa709a" style="background: #fa709a;" title="粉红色"></button>
                                            <button type="button" class="color-option" data-color="#ffecd2" style="background: #ffecd2;" title="浅黄色"></button>
                                            <button type="button" class="color-option" data-color="#a8edea" style="background: #a8edea;" title="青色"></button>
                                            <button type="button" class="color-option" data-color="#ffd89b" style="background: #ffd89b;" title="橙黄色"></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>初始化选项</label>
                                <div class="checkbox-group">
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="create-sample-areas" checked>
                                        <span class="checkmark"></span>
                                        创建示例知识区（帮助您快速开始）
                                    </label>
                                </div>
                            </div>
                            
                            <div class="knowledge-base-preview">
                                <h4>预览效果</h4>
                                <div class="preview-card">
                                    <div class="preview-icon">📚</div>
                                    <div class="preview-title">知识库名称</div>
                                    <div class="preview-description">知识库描述</div>
                                    <div class="preview-stats">
                                        <div class="preview-stat">
                                            <div class="stat-number">0</div>
                                            <div class="stat-label">知识区</div>
                                        </div>
                                        <div class="preview-stat">
                                            <div class="stat-number">0</div>
                                            <div class="stat-label">知识点</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-modal="create-knowledge-base-modal">取消</button>
                        <button type="submit" form="create-knowledge-base-form" class="btn btn-primary">创建知识库</button>
                    </div>
                </div>
            </div>

            <!-- 创建知识区模态框 -->
            <div id="create-knowledge-area-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>📖 创建新知识区</h3>
                        <button class="close-btn" data-modal="create-knowledge-area-modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="create-knowledge-area-form">
                            <div class="form-group">
                                <label for="area-name">知识区名称 *</label>
                                <input type="text" id="area-name" name="name" required 
                                       placeholder="例如：基础概念、重点难点、实践应用等">
                            </div>
                            
                            <div class="form-group">
                                <label for="area-description">知识区描述</label>
                                <textarea id="area-description" name="description" rows="3" 
                                         placeholder="简要描述这个知识区的内容和特点..."></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="area-color">主题颜色</label>
                                <div class="color-selector">
                                    <input type="hidden" id="area-color" name="color" value="#667eea">
                                    <div class="color-grid">
                                        <button type="button" class="color-option active" data-color="#667eea" style="background: #667eea;" title="蓝紫色"></button>
                                        <button type="button" class="color-option" data-color="#f093fb" style="background: #f093fb;" title="粉紫色"></button>
                                        <button type="button" class="color-option" data-color="#4facfe" style="background: #4facfe;" title="天蓝色"></button>
                                        <button type="button" class="color-option" data-color="#43e97b" style="background: #43e97b;" title="绿色"></button>
                                        <button type="button" class="color-option" data-color="#fa709a" style="background: #fa709a;" title="粉红色"></button>
                                        <button type="button" class="color-option" data-color="#ffecd2" style="background: #ffecd2;" title="浅黄色"></button>
                                        <button type="button" class="color-option" data-color="#a8edea" style="background: #a8edea;" title="青色"></button>
                                        <button type="button" class="color-option" data-color="#ffd89b" style="background: #ffd89b;" title="橙黄色"></button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="knowledge-base-preview">
                                <h4>预览效果</h4>
                                <div class="preview-card">
                                    <div class="preview-title">知识区名称</div>
                                    <div class="preview-description">知识区描述</div>
                                    <div class="preview-stats">
                                        <div class="preview-stat">
                                            <div class="stat-number">0</div>
                                            <div class="stat-label">知识点</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-modal="create-knowledge-area-modal">取消</button>
                        <button type="submit" form="create-knowledge-area-form" class="btn btn-primary">创建知识区</button>
                    </div>
                </div>
            </div>

            <!-- 复习页面 -->
            <section id="review" class="content-section">
                <div class="review-container">
                    <div class="review-header">
                        <h2>复习模式</h2>
                        <div class="review-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="review-progress"></div>
                            </div>
                            <span class="progress-text" id="progress-text">0/0</span>
                        </div>
                    </div>

                    <div class="review-modes" id="review-modes">
                        <h3>选择复习模式</h3>
                        <div class="mode-buttons">
                            <button class="btn btn-primary mode-btn" data-mode="scheduled">顺序复习</button>
                            <button class="btn btn-secondary mode-btn" data-mode="random">随机复习</button>
                            <button class="btn btn-secondary mode-btn" data-mode="category" id="category-mode-btn">分类复习</button>
                        </div>
                    </div>

                    <div class="review-card" id="review-card" style="display: none;">
                        <!-- 左侧导航按钮 -->
                        <button class="btn btn-outline nav-btn nav-btn-left" id="prev-question-btn" title="上一题 (快捷键: ←)" disabled>
                            <span>←</span>
                        </button>
                        
                        <!-- 右侧导航按钮 -->
                        <button class="btn btn-outline nav-btn nav-btn-right" id="next-question-btn" title="下一题 (快捷键: →)" disabled>
                            <span>→</span>
                        </button>
                        
                        <div class="card-content">
                            <div class="question-section">
                                <h3>题目</h3>
                                <div class="question-text" id="question-text"></div>
                            </div>
                            
                            <div class="user-answer-section">
                                <h3>我的答案</h3>
                                <div id="user-answer-section">
                                    <!-- 答题区域将根据题目类型动态生成 -->
                                    <div class="fill-question-container">
                                        <div class="user-answer-area">
                                            <label for="user-answer-input" class="answer-label">您的答案：</label>
                                            <textarea id="user-answer-input" 
                                                      class="user-answer-input" 
                                                      placeholder="请输入您的答案..." 
                                                      rows="3"></textarea>
                                            <div class="input-hint">
                                                <span>💡 提示：按 Ctrl+Enter 快速显示/隐藏答案</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 笔记区域 -->
                            <div class="note-section" id="note-section">
                                <div class="note-header">
                                    <h3>📄 笔记</h3>
                                    <button class="btn btn-sm btn-outline" id="toggle-note-btn" onclick="window.reviewManager.toggleNote()">展开</button>
                                </div>
                                <div class="note-content collapsed" id="note-content">
                                    <textarea class="note-textarea" id="review-note-input" 
                                             placeholder="在此添加您的笔记..."
                                             onblur="window.reviewManager.updateCurrentNote(this.value)"></textarea>
                                </div>
                            </div>
                            
                            <div class="answer-section" id="answer-section" style="display: none;">
                                <h3>标准答案</h3>
                                <div class="answer-text" id="answer-text"></div>
                                <div class="explanation-text" id="explanation-text"></div>
                                
                                <!-- 选择题结果提示 -->
                                <div id="choice-result-hint" class="choice-result-hint" style="display: none;">
                                    <div class="result-icon">✅</div>
                                    <div class="result-text">
                                        <div>回答正确！</div>
                                        <div class="correct-answer-hint">您的答案：A</div>
                                    </div>
                                </div>
                                
                                <!-- 自动评分提示 -->
                                <div id="auto-rating-hint" class="auto-rating-hint" style="display: none;">
                                    <div class="rating-message">✅ 系统自动评分：正确</div>
                                    <div class="next-question-countdown">
                                        <span id="countdown-number">2</span>秒后自动进入下一题...
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card-actions">
                            <!-- 底部：显示答案和自评功能 -->
                            <div class="answer-section-controls">
                                <div class="show-answer-container">
                                    <button class="btn btn-secondary" id="show-answer-btn" title="快捷键: Ctrl+Enter 显示/隐藏答案">显示答案</button>
                                </div>
                                
                                <div class="rating-section" id="rating-buttons" style="display: none;">
                                    <div class="rating-buttons">
                                        <span class="rating-label">自评：</span>
                                        <button class="btn btn-danger" data-rating="1">错误</button>
                                        <button class="btn btn-warning" data-rating="2">模糊</button>
                                        <button class="btn btn-success" data-rating="3">正确</button>
                                    </div>
                                </div>
                                
                                <!-- 评分输入区域 -->
                                <div class="score-section" id="score-section" style="display: none;">
                                    <div class="score-input-container">
                                        <label for="score-input">评分 (1-5分)：</label>
                                        <input type="number" id="score-input" min="1" max="5" step="1" 
                                               placeholder="1-5" onchange="window.reviewManager.updateCurrentScore(this.value)">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 错题本页面 -->
            <section id="mistakes" class="content-section">
                <div class="section-header">
                    <h2>错题本</h2>
                    <div class="header-actions">
                        <button class="btn btn-primary" id="review-all-mistakes">复习所有错题</button>
                        <button class="btn btn-secondary" id="clear-resolved-mistakes">清除已掌握</button>
                    </div>
                </div>
                
                <!-- 错题统计概览 -->
                <div class="mistakes-overview" id="mistakes-overview">
                    <!-- 统计信息将通过JavaScript动态生成 -->
                </div>
                
                <!-- 知识区分类标签 -->
                <div class="mistakes-filter">
                    <div class="filter-tabs" id="mistakes-filter-tabs">
                        <button class="filter-tab active" data-area="all">全部错题</button>
                        <!-- 知识区标签将通过JavaScript动态生成 -->
                    </div>
                </div>
                
                <!-- 错题列表容器 -->
                <div class="mistakes-container">
                    <!-- 所有错题视图 -->
                    <div class="mistakes-view active" id="mistakes-view-all">
                        <div class="mistakes-list" id="mistakes-list-all">
                            <!-- 所有错题列表 -->
                        </div>
                    </div>
                    
                    <!-- 按知识区分类的错题视图 -->
                    <div class="mistakes-areas" id="mistakes-areas">
                        <!-- 知识区错题列表将通过JavaScript动态生成 -->
                    </div>
                </div>
            </section>

            <!-- 统计分析页面 -->
            <section id="statistics" class="content-section">
                <div class="section-header">
                    <h2>统计分析</h2>
                    <button class="btn btn-secondary" onclick="window.statisticsManager.exportReport()">导出报告</button>
                </div>
                
                <div class="stats-container">
                    <div class="chart-container">
                        <h3>学习进度</h3>
                        <canvas id="progress-chart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h3>正确率趋势</h3>
                        <canvas id="accuracy-chart"></canvas>
                    </div>
                </div>
                
                <div class="detailed-stats" id="detailed-stats">
                    <!-- 详细统计将通过JavaScript生成 -->
                </div>
            </section>
        </div>
    </main>

    <!-- 模态框 -->
    <div class="modal" id="knowledge-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">添加知识点</h3>
                <button class="close-btn" id="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="knowledge-form">
                    <!-- 题目类型选择 -->
                    <div class="form-group">
                        <label for="question-type">题目类型</label>
                        <select id="question-type" required onchange="window.knowledgeManager.handleQuestionTypeChange(this.value)">
                            <option value="fill">填空题</option>
                            <option value="choice">选择题</option>
                        </select>
                    </div>
                    
                    <!-- 题目 -->
                    <div class="form-group">
                        <label for="question-input">题目 *</label>
                        <textarea id="question-input" required placeholder="请输入题目内容..."></textarea>
                    </div>
                    
                    <!-- 填空题答案区域 -->
                    <div id="fill-answer-section" class="form-group">
                        <label for="answer-input">答案 *</label>
                        <textarea id="answer-input" required placeholder="请输入标准答案..."></textarea>
                    </div>
                    
                    <!-- 选择题配置区域 -->
                    <div id="choice-answer-section" class="choice-section" style="display: none;">
                        <!-- 选择题类型 -->
                        <div class="form-group">
                            <label for="choice-type">选择题类型</label>
                            <select id="choice-type">
                                <option value="single">单选题</option>
                                <option value="multiple">多选题</option>
                            </select>
                        </div>
                        
                        <!-- 选项配置 -->
                        <div class="form-group">
                            <label>选项配置</label>
                            <div class="choice-config-hint">
                                <span class="hint-icon">💡</span>
                                <span class="hint-text">点击选项标签（如 A. B.）来设置正确答案</span>
                            </div>
                            <div id="choice-options-container">
                                <!-- 选项A -->
                                <div class="choice-option-row">
                                    <button type="button" class="option-label clickable" data-option="A" title="点击设为正确答案">A.</button>
                                    <input type="text" class="option-text" placeholder="请输入选项A的内容..." required>
                                </div>
                                <!-- 选项B -->
                                <div class="choice-option-row">
                                    <button type="button" class="option-label clickable" data-option="B" title="点击设为正确答案">B.</button>
                                    <input type="text" class="option-text" placeholder="请输入选项B的内容..." required>
                                </div>
                                <!-- 选项C -->
                                <div class="choice-option-row">
                                    <button type="button" class="option-label clickable" data-option="C" title="点击设为正确答案">C.</button>
                                    <input type="text" class="option-text" placeholder="请输入选项C的内容...">
                                </div>
                                <!-- 选项D -->
                                <div class="choice-option-row">
                                    <button type="button" class="option-label clickable" data-option="D" title="点击设为正确答案">D.</button>
                                    <input type="text" class="option-text" placeholder="请输入选项D的内容...">
                                </div>
                            </div>
                            <div class="choice-actions">
                                <button type="button" class="btn btn-sm btn-secondary" id="add-option-btn">➕ 添加选项</button>
                                <button type="button" class="btn btn-sm btn-secondary" id="remove-option-btn">➖ 删除选项</button>
                            </div>
                        </div>
                        
                        <!-- 分数设置 -->
                        <div class="form-group">
                            <label for="score-input">分数</label>
                            <input type="number" id="score-input" min="0" max="100" placeholder="题目分数（可选）">
                        </div>
                    </div>
                    
                    <!-- 解析 -->
                    <div class="form-group">
                        <label for="explanation-input">解析</label>
                        <textarea id="explanation-input" placeholder="请输入题目解析（可选）..."></textarea>
                    </div>
                    
                    <!-- 笔记 -->
                    <div class="form-group">
                        <label for="note-input">笔记</label>
                        <textarea id="note-input" placeholder="添加您的个人笔记..."></textarea>
                    </div>
                    
                    <!-- 其他信息 -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="category-input">分类</label>
                            <input type="text" id="category-input" placeholder="知识点分类">
                        </div>
                        <div class="form-group">
                            <label for="difficulty-input">难度</label>
                            <select id="difficulty-input">
                                <option value="1">简单</option>
                                <option value="2">较易</option>
                                <option value="3" selected>中等</option>
                                <option value="4">较难</option>
                                <option value="5">困难</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- 标签 -->
                    <div class="form-group">
                        <label for="tags-input">标签（用逗号分隔）</label>
                        <input type="text" id="tags-input" placeholder="例如：重点,难点,考试">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancel-btn">取消</button>
                <button type="submit" class="btn btn-primary" id="save-btn">保存</button>
            </div>
        </div>
    </div>

    <!-- JavaScript文件 -->
    <script src="js/utils.js?v=1.0.2"></script>
    <script src="js/storage.js?v=1.0.2"></script>
    <script src="js/choice-processor.js?v=1.0.2"></script>
    <script src="js/question-list-generator.js?v=1.0.2"></script>
    <script src="js/data-migration.js?v=1.0.2"></script>
    <script src="js/knowledge.js?v=1.0.2"></script>
    <script src="js/review.js?v=1.0.2"></script>
    <script src="js/statistics.js?v=1.0.2"></script>
    <script src="js/imports/military-import-complete.js?v=1.0.2"></script>
    <script src="js/imports/software-engineering-import.js"></script>
    <script src="js/imports/requirements-analysis-import.js"></script>
    <script src="js/imports/software-design-import.js"></script>
    <script src="js/imports/detailed-design-import.js"></script>
    <script src="js/imports/software-implementation-import.js"></script>
    <script src="js/imports/software-testing-import.js"></script>
    <script src="js/imports/software-deployment-import.js"></script>
    <script src="fix_knowledge_base_ids.js"></script>
    <script src="test_restructure.js"></script>
    <script src="test_knowledge_base_review.js"></script>
    <script src="test_choice_shuffle.js"></script>
    <script src="js/app.js?v=1.0.2"></script>
    
    <!-- 清空数据功能 - 确保立即可用 -->
    <script>
        // 清空数据函数
        window.clearAllDataWithConfirm = function() {
            try {
                // 检查存储管理器是否可用
                if (typeof window.storageManager === 'undefined') {
                    alert('❌ 系统未完全加载，请刷新页面后重试');
                    return;
                }
                
                // 获取当前数据状态
                const knowledgeBases = window.storageManager.getAllKnowledgeBases();
                const allKnowledge = window.storageManager.getAllKnowledge();
                
                // 如果没有数据，直接提示
                if (knowledgeBases.length === 0 && allKnowledge.length === 0) {
                    alert('ℹ️ 当前没有数据需要清空');
                    return;
                }
                
                // 构建确认消息
                let confirmMessage = '⚠️ 您确定要清空所有数据吗？\n\n这将删除：\n';
                
                if (knowledgeBases.length > 0) {
                    confirmMessage += `• ${knowledgeBases.length} 个知识库\n`;
                    knowledgeBases.forEach(base => {
                        const count = window.storageManager.getKnowledgeByBaseId(base.id).length;
                        confirmMessage += `  - ${base.name}（${count}个知识点）\n`;
                    });
                }
                
                if (allKnowledge.length > 0) {
                    confirmMessage += `• 总计 ${allKnowledge.length} 个知识点\n`;
                }
                
                const mistakes = window.storageManager.getMistakes();
                if (mistakes.length > 0) {
                    confirmMessage += `• ${mistakes.length} 个错题记录\n`;
                }
                
                confirmMessage += '\n此操作不可恢复！';
                
                // 显示确认对话框
                if (confirm(confirmMessage)) {
                    // 执行清空操作
                    localStorage.removeItem('memorin_data');
                    
                    // 重新初始化存储管理器
                    if (window.storageManager && typeof window.storageManager.init === 'function') {
                        window.storageManager.init();
                    }
                    
                    // 刷新界面
                    if (window.app && typeof window.app.loadDashboard === 'function') {
                        window.app.loadDashboard();
                    }
                    
                    // 刷新知识管理器
                    if (window.knowledgeManager && typeof window.knowledgeManager.refresh === 'function') {
                        window.knowledgeManager.refresh();
                    }
                    
                    // 显示成功消息并刷新页面
                    alert('✅ 所有数据已清空！');
                    setTimeout(() => window.location.reload(), 1000);
                }
                
            } catch (error) {
                console.error('清空数据失败:', error);
                alert('❌ 清空数据失败：' + error.message);
            }
        };
        
        // 整合的软件工程知识库导入函数
        window.importAllSoftwareEngineeringKnowledge = async function() {
            try {
                // 检查系统是否已加载
                if (typeof window.storageManager === 'undefined') {
                    alert('❌ 系统未完全加载，请刷新页面后重试');
                    return;
                }
                
                // 显示确认对话框
                const confirmMessage = '📚 即将导入完整的软件工程知识库\n\n包含以下模块：\n' +
                    '• 软件工程概述\n' +
                    '• 软件过程与项目管理\n' +
                    '• 需求分析\n' +
                    '• 软件概要设计\n' +
                    '• 软件详细设计\n' +
                    '• 软件实现\n' +
                    '• 软件测试\n' +
                    '• 软件部署运维\n\n' +
                    '确定要继续吗？';
                
                if (!confirm(confirmMessage)) {
                    return;
                }
                
                let successCount = 0;
                let totalCount = 8;
                let errors = [];
                
                console.log('开始导入软件工程知识库...');
                
                // 依次调用各个导入函数
                const importFunctions = [
                    { name: '软件工程概述', func: 'importSoftwareEngineeringOverview' },
                    { name: '软件过程与项目管理', func: 'importSoftwareProcessManagement' },
                    { name: '需求分析', func: 'importRequirementsAnalysis' },
                    { name: '软件概要设计', func: 'importSoftwareDesign' },
                    { name: '软件详细设计', func: 'importDetailedDesign' },
                    { name: '软件实现', func: 'importSoftwareImplementation' },
                    { name: '软件测试', func: 'importSoftwareTesting' },
                    { name: '软件部署运维', func: 'importSoftwareDeployment' }
                ];
                
                for (const item of importFunctions) {
                    try {
                        console.log(`正在导入: ${item.name}`);
                        
                        // 检查函数是否存在
                        if (typeof window[item.func] === 'function') {
                            await window[item.func]();
                            successCount++;
                            console.log(`✅ ${item.name} 导入成功`);
                        } else {
                            console.warn(`⚠️ 函数 ${item.func} 不存在，跳过 ${item.name}`);
                            errors.push(`${item.name}: 导入函数不存在`);
                        }
                        
                        // 添加延迟避免操作过快
                        await new Promise(resolve => setTimeout(resolve, 500));
                        
                    } catch (error) {
                        console.error(`❌ ${item.name} 导入失败:`, error);
                        errors.push(`${item.name}: ${error.message}`);
                    }
                }
                
                // 显示导入结果
                let resultMessage = `🎉 软件工程知识库导入完成！\n\n`;
                resultMessage += `✅ 成功导入: ${successCount}/${totalCount} 个模块\n`;
                
                if (errors.length > 0) {
                    resultMessage += `\n⚠️ 导入失败的模块：\n`;
                    errors.forEach(error => {
                        resultMessage += `• ${error}\n`;
                    });
                }
                
                alert(resultMessage);
                
                // 刷新界面
                if (window.app && typeof window.app.loadDashboard === 'function') {
                    window.app.loadDashboard();
                }
                
                // 刷新知识管理器
                if (window.knowledgeManager && typeof window.knowledgeManager.refresh === 'function') {
                    window.knowledgeManager.refresh();
                }
                
            } catch (error) {
                console.error('整合导入失败:', error);
                alert('❌ 导入过程中发生错误：' + error.message);
            }
        };
        
        // 整合的数据修复函数
        window.quickFixAllData = async function() {
            try {
                // 检查系统是否已加载
                if (typeof window.storageManager === 'undefined') {
                    alert('❌ 系统未完全加载，请刷新页面后重试');
                    return;
                }
                
                // 显示确认对话框
                const confirmMessage = '🔧 快速修复数据功能\n\n将执行以下操作：\n' +
                    '• 测试数据一致性\n' +
                    '• 快速修复映射关系\n' +
                    '• 执行数据重构（如需要）\n\n' +
                    '此操作是安全的，不会删除您的数据。\n确定要继续吗？';
                
                if (!confirm(confirmMessage)) {
                    return;
                }
                
                let results = [];
                console.log('开始快速修复数据...');
                
                // 1. 测试数据一致性
                try {
                    console.log('正在测试数据一致性...');
                    if (typeof window.testDataRestructure === 'function') {
                        await window.testDataRestructure();
                        results.push('✅ 数据一致性测试完成');
                    } else {
                        results.push('⚠️ 数据一致性测试函数不存在');
                    }
                } catch (error) {
                    console.error('数据一致性测试失败:', error);
                    results.push(`❌ 数据一致性测试失败: ${error.message}`);
                }
                
                // 添加延迟
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // 2. 快速修复映射关系
                try {
                    console.log('正在修复映射关系...');
                    if (typeof window.quickFixMappings === 'function') {
                        await window.quickFixMappings();
                        results.push('✅ 映射关系修复完成');
                    } else {
                        results.push('⚠️ 映射关系修复函数不存在');
                    }
                } catch (error) {
                    console.error('映射关系修复失败:', error);
                    results.push(`❌ 映射关系修复失败: ${error.message}`);
                }
                
                // 添加延迟
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // 3. 执行数据重构（如果需要）
                try {
                    console.log('检查是否需要数据重构...');
                    if (typeof window.executeDataRestructure === 'function') {
                        // 先检查是否需要重构
                        const knowledgeBases = window.storageManager.getAllKnowledgeBases();
                        if (knowledgeBases.length === 0) {
                            console.log('检测到可能需要数据重构，执行重构...');
                            await window.executeDataRestructure();
                            results.push('✅ 数据重构执行完成');
                        } else {
                            results.push('ℹ️ 数据结构正常，无需重构');
                        }
                    } else {
                        results.push('⚠️ 数据重构函数不存在');
                    }
                } catch (error) {
                    console.error('数据重构失败:', error);
                    results.push(`❌ 数据重构失败: ${error.message}`);
                }
                
                // 显示修复结果
                let resultMessage = '🔧 数据修复完成！\n\n执行结果：\n';
                results.forEach(result => {
                    resultMessage += `${result}\n`;
                });
                
                alert(resultMessage);
                
                // 刷新界面
                if (window.app && typeof window.app.loadDashboard === 'function') {
                    window.app.loadDashboard();
                }
                
                // 刷新知识管理器
                if (window.knowledgeManager && typeof window.knowledgeManager.refresh === 'function') {
                    window.knowledgeManager.refresh();
                }
                
            } catch (error) {
                console.error('快速修复失败:', error);
                alert('❌ 修复过程中发生错误：' + error.message);
            }
        };
    </script>
</body>
</html> 